<!DOCTYPE html>
<html ng-app="theyLiveApp">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>They Live Meme Generator</title>

    <script src="https://cdn.rawgit.com/niklasvh/html2canvas/0.5.0-alpha1/dist/html2canvas.min.js"></script>
    <script src="https://code.angularjs.org/1.4.3/angular.min.js"></script>
    <link rel="stylesheet" href="https://cdn.rawgit.com/yahoo/pure-release/v0.6.0/pure-min.css">

    <script>
      var theyLiveApp = angular.module("theyLiveApp", []);

      theyLiveApp.controller("TheyLiveCtrl", ["$scope", function ($scope) {
        $scope.meme = {
          user: "Large_Billboard_in_the_City",
          karma: 420,
          time: "8 hours ago",
          gilded: true,
          comment: "come to the... CARRIBEAN!",
          imageUrl: "https://i.imgur.com/gVoKjRz.jpg",
          reveal: "MARRY AND REPRODUCE"
        };

        $scope.generateFreshMemes = function() {
          console.log("c");
          var stage = document.getElementById("stage");
          var outputContainer = document.getElementById("output");

          outputContainer.innerHTML = "";
          stage.style.display = "block";

          html2canvas(stage, {
            width: 632,
            useCORS: true,
            onrendered: function(canvas) {
              stage.style.display = "none";
              outputContainer.appendChild(canvas);
            }
          });
        };

        angular.element(document).ready(function () {
          $scope.generateFreshMemes();
        });
      }]);
    </script>

    <style>
      body { background: #ddd;}
      #stage { width: 600px; padding: 1em; text-align: center; }

      .comment-box {
        color: #222;
        font: 14px/20px Verdana, Arial, Helvetica, sans-serif;
        text-align: left;
        position: relative;
        margin: 0;
        top: -48px;
        left: 24px;
      }

      img {
        margin-top: -2.5em;
        margin-bottom: 0.5em;
        margin-left: -1em;
        width: 632px;
      }

      .tagline {
        font-size: small;
      }

      .tagline a {
        margin-right: 3px;
      }

      .user {
        color: #369;
        font-weight: bold;
      }

      .karma, .time {
        color: #888;
      }

      .icon-gilded {
        display: inline-block;
        width: 1em;
        background-size: 1em;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABI1BMVEUAAAB9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiR9ZiSijUCijUCkj0KlkEKlkEOmkUO5pVKijUa6plKAaSaBaieBaienkkSBaienk0S7qFPItl1+ZySahkG7p1O7qFR+ZyWlkEp9ZiSqllC7qFTJt159ZiR+ZyV/aCiAaSmDbSyFby+IcjKJczOJdDmLdjWLdz2biVebilich0OejVyfjl6fjl+jkEmql1Cum1GvoXywnE+wo3y8qFm8qVnCr13Jt17Kt1/NxK3Zx2rbyWvdzG3d18fe2Mjgzm/n1XTo13bp2Hbq2Hft3Hnu6+Pv3nv15H/354H39vL454L46IL764T87IX97YX/74f///+fK0mhAAAALXRSTlMAAyQmOW5viImLjJ6fpqi0tb7s7fHy9PX19/f4+Pn5+vr7+/z8/Pz9/f7+/v7uuEIkAAABQklEQVR42nWR11rCQBCFQ1d6rAjEFjVGPfQqghSlBDSEKgkwvP9TmA3o543nYnfOf3F2Z4bbye7yhUI+l537KyePnXjnL7Tty7i47ChK51yA7LHtaBDSo0E0GhHptxKCW+6FoBLRPJ2em5cqwGvlQmKU3oB3YlwCy+dxx9xXBsjorLoCz3EOCAatZ4Mmqi9oDmZrMgQ4ODdOVs9JmPr8YGfyZnUKN+dHd5kFSo3eZtNrlIDssgs/F4ZCWg7lxcbUooycRgrCFqZJARWGKyhMiGEWQkRD5BnOY2gaFuLGsVn1UZ22WtMq+qY5Mp+0sw9SG8UUkCqiTWTEYGftRIlegUS9ngAeiKLgWfOyqNI9ahqRVsMZqaJsDXcPcVUfk6Wxrsbh2Q42ADGib7EeERH4GbhHRuzgWlGeDmNsDf8v7Z8VfwNk7Va0nguu7gAAAABJRU5ErkJggg==);
        background-repeat: no-repeat;
        background-position: center;
      }

      .icon-arrows {
        height: 30px;
        width: 15px;
        background-image: url(data:image/gif;base64,R0lGODlhDwAeAIQTALa2tre3t7i4uLy8vL29vb6+vsDAwMHBwcLCwsfHx8jIyMrKys3Nzc7OztPT09TU1NjY2Nvb29zc3P///////////////////////////////////////////////////yH5BAEKAB8ALAAAAAAPAB4AAAWM4CeOX0CeZDAI6CkUAWG2n3AEuDGfwR0AOVaqACj+fgVhTXYE4mKmQIFAZQoI0+lOtCAMBguaqIFAHBrijyORUDzSEAajAUlHHg9HJC2J+CVpgYItfX92eHpwcnRpa21vYmRmaGJdX2FDVVZYnCZXOEBOODIjUkWhSEoiPaBBLTZPOmIvUIEqqmJbIyEAOw==);
        background-repeat: no-repeat;
        background-position: center;
        position: relative;
        left: 2px;
      }

      #output canvas, #stage { background: white; }

      .reveal { 
        font: bold 16px Arial, Helvetica, sans-serif;
        width: 100%;
        text-align: center;
        padding: 2em 0;
        margin: auto;
        width: 450px;
        position: relative;
        left: -30px;
        margin-bottom: -3em;
      }

      .comment {
        margin-top: -0.7em;
        width: 550px;
      }

      .reveal-container {
        margin: -1em;
        margin-top: -.5em;
        padding: 1em;
      }
    </style>
  </head>

  <body ng-controller="TheyLiveCtrl">

<div class="pure-g">

    <div class="pure-u-1-2">

<h1><em>They Live</em> Meme Generator</h1>

<form autocomplete="off" class="pure-form pure-form-stacked">

      <fieldset>

        <label for="user">Username</label>
        <input id="user" ng-model="meme.user">

        <label for="karma">Karma</label>
        <input id="karma" ng-model="meme.karma">

        <label for="time">Time</label>
        <input id="time" ng-model="meme.time">

        <label for="gilded">Gilded</label>
        <input id="gilded" ng-model="meme.gilded" type="checkbox">

        <label for="comment">Comment</label>
        <textarea id="comment" ng-model="meme.comment"></textarea>

        <label for="image-url">Glasses Image URL</label>
        <input id="image-url" ng-model="meme.imageUrl">

        <label for="reveal">Reveal</label>
        <textarea id="reveal" ng-model="meme.reveal"></textarea>

        <button ng-click="generateFreshMemes(meme)" class="pure-button pure-button-primary">
          Generate fresh memes now!
        </button>

        <p>Right-click on the image -&gt; Save Image As.</p>

      </fieldset>
    </form>


    </div>

    <div class="pure-u-1-2">

        <div id="stage">
          <div class="icon-arrows">&nbsp;</div>
          <div class="comment-box">
            <p class="tagline">
              <a>[-]</a>
              <a href="#" class="user">{{ meme.user }}</a>
              <span class="karma">{{ meme.karma }} points</span>
              <span class="time">{{ meme.time }}</span>
              <span class="icon-gilded" ng-if="meme.gilded">&nbsp;</span>
            </p>
            <p class="comment"> {{ meme.comment }} </p>
          </div>

      <img ng-src="{{ meme.imageUrl }}" alt="John Nada removing his sunglasses in the 1988 film, They Live">

      <div class="shaded"></div>

      <div class="reveal-container">
      <div class="icon-arrows">&nbsp;</div>
      <div class="comment-box">
        <p class="tagline">
          <a>[-]</a>
          <a href="#" class="user">{{ meme.user }}</a>
          <span class="karma">{{ meme.karma }} points</span>
          <span class="time">{{ meme.time }}</span>
          <span class="icon-gilded" ng-if="meme.gilded">&nbsp;</span>
        </p>
        <p class="comment reveal"> {{ meme.reveal }} </p>
      </div>
    </div>
    </div>

    <div id="output"></div>

    </div>

</div>

  </body>
</html>